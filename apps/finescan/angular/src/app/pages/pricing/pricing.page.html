<ion-header>
    <ion-toolbar>
        <ion-buttons slot="start">
            <ion-back-button></ion-back-button>
        </ion-buttons>
        <ion-title>Pricing Plans</ion-title>
    </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
    <div class="pricing-header ion-text-center">
        <h1>Choose Your Plan</h1>
        <p>Start with our free plan or upgrade for more features</p>
    </div>

    <div class="pricing-grid">
        @for (plan of plans$ | async; track plan.id) {
        <ion-card [class.featured]="plan.isPopular">
            @if (plan.isPopular) {
            <ion-badge color="primary" class="featured-badge">
                Most Popular
            </ion-badge>
            }
            <ion-card-header>
                <ion-card-title>{{ plan.name }}</ion-card-title>
                <ion-card-subtitle>
                    @if (plan.price === 0) {
                    <span class="price">Free</span>
                    } @else if (plan.price === null) {
                    <span class="price">Contact Sales</span>
                    } @else {
                    <span class="price">${{ plan.price }}/month</span>
                    }
                </ion-card-subtitle>
            </ion-card-header>

            <ion-card-content>
                <ion-list>
                    @for (feature of plan.features; track feature) {
                    <ion-item lines="none">
                        <ion-icon name="checkmark-circle-outline" slot="start" color="success"></ion-icon>
                        <ion-label>{{ feature }}</ion-label>
                    </ion-item>
                    }
                </ion-list>

                <div class="plan-limits">
                    <ion-item lines="none">
                        <ion-icon name="flash-outline" slot="start"></ion-icon>
                        <ion-label>
                            @if (plan.scanLimit === Infinity) {
                            Unlimited scans
                            } @else {
                            {{ plan.scanLimit }} scans/month
                            }
                        </ion-label>
                    </ion-item>
                    <ion-item lines="none">
                        <ion-icon name="server-outline" slot="start"></ion-icon>
                        <ion-label>
                            @if (plan.storageLimit === Infinity) {
                            Unlimited storage
                            } @else {
                            {{ formatStorage(plan.storageLimit) }} storage
                            }
                        </ion-label>
                    </ion-item>
                    <ion-item lines="none">
                        <ion-icon name="time-outline" slot="start"></ion-icon>
                        <ion-label>{{ plan.retentionDays }} days retention</ion-label>
                    </ion-item>
                </div>

                <ion-button expand="block" [color]="plan.isPopular ? 'primary' : 'medium'" (click)="selectPlan(plan)"
                    [disabled]="(currentPlan$ | async)?.id === plan.id">
                    @if ((currentPlan$ | async)?.id === plan.id) {
                    Current Plan
                    } @else if (plan.tier === 'business') {
                    Contact Sales
                    } @else if (plan.tier === 'free') {
                    Get Started
                    } @else {
                    Upgrade Now
                    }
                </ion-button>
            </ion-card-content>
        </ion-card>
        }
    </div>
</ion-content>